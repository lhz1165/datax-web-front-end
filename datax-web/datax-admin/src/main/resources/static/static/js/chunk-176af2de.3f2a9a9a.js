(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-176af2de"],{"0112":function(e,t,a){"use strict";a.d(t,"d",(function(){return n})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return o})),a.d(t,"e",(function(){return s})),a.d(t,"b",(function(){return c})),a.d(t,"f",(function(){return l}));a("6b54"),a("ac6a");var r=a("b775");function n(e){return Object(r["a"])({url:"/api/jobApi",method:"get",params:e})}function i(e){return Object(r["a"])({url:"/api/jobApi/".concat(e),method:"get"})}function o(e){return Object(r["a"])({url:"/api/jobApi",method:"post",data:e})}function s(e){return Object(r["a"])({url:"/api/jobApi",method:"put",data:e})}function c(e){return Object(r["a"])({url:"/api/jobApi",method:"delete",params:{idList:e},paramsSerializer:function(e){var t=new URLSearchParams;return Array.isArray(e.idList)?e.idList.forEach((function(e){return t.append("idList",e)})):void 0!==e.idList&&null!==e.idList&&t.append("idList",e.idList),t.toString()}})}function l(e){return Object(r["a"])({url:"/api/jobApi/status",method:"post",data:e})}},"19fb":function(e,t,a){},"28d4":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"filter-container"},[a("el-select",{staticClass:"filter-item",staticStyle:{width:"220px"},attrs:{placeholder:"数据源",clearable:""},model:{value:e.query.datasourceId,callback:function(t){e.$set(e.query,"datasourceId",t)},expression:"query.datasourceId"}},e._l(e.datasourceList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.datasourceName||e.datasource,value:e.id}})})),1),e._v(" "),a("el-select",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"请求方式",clearable:""},model:{value:e.query.method,callback:function(t){e.$set(e.query,"method",t)},expression:"query.method"}},e._l(e.apiTypes,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e._v(" "),a("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.fetchData}},[e._v("\n      搜索\n    ")]),e._v(" "),a("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.handleCreate}},[e._v("\n      创建API\n    ")])],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.list,border:"",fit:"","highlight-current-row":"",size:"small"}},[a("el-table-column",{attrs:{label:"名称",prop:"name","min-width":"140",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"数据源",prop:"datasourceName","min-width":"160",align:"center","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{label:"Path",prop:"path","min-width":"180",align:"center","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{label:"请求方式",prop:"method",width:"90",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e.formatMethod(t.row.method))+"\n      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"返回类型",prop:"responseType",width:"130",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.responseType||"-")+"\n      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"状态",prop:"status",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.statusTagType(t.row.status),size:"mini"}},[e._v("\n          "+e._s(e.formatStatus(t.row.status))+"\n        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"创建时间",prop:"createDate",width:"160",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"描述",prop:"description","min-width":"180","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"220",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.handleView(t.row)}}},[e._v("查看")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v("配置")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini",disabled:0!==t.row.status},on:{click:function(a){return e.handleEnable(t.row)}}},[e._v("\n          启用\n        ")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini",disabled:0===t.row.status},on:{click:function(a){return e.handleDisable(t.row)}}},[e._v("\n          禁用\n        ")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{"current-page":e.query.pageNo,"page-size":e.query.pageSize,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.createDialogVisible,width:"600px"},on:{"update:visible":function(t){e.createDialogVisible=t}}},[a("el-form",{ref:"createFormRef",attrs:{model:e.createForm,rules:e.createRules,"label-width":"90px"}},[a("el-form-item",{attrs:{label:"数据源",prop:"datasourceId"}},[a("el-select",{attrs:{placeholder:"请选择数据源",filterable:""},model:{value:e.createForm.datasourceId,callback:function(t){e.$set(e.createForm,"datasourceId",t)},expression:"createForm.datasourceId"}},e._l(e.datasourceList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.datasourceName||e.datasource,value:e.id}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入API名称"},model:{value:e.createForm.name,callback:function(t){e.$set(e.createForm,"name",t)},expression:"createForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Path",prop:"path"}},[a("el-input",{attrs:{placeholder:"例如：/demo/user/list"},model:{value:e.createForm.path,callback:function(t){e.$set(e.createForm,"path",t)},expression:"createForm.path"}},[a("template",{slot:"prepend"},[e._v("/api/ds/v1")])],2)],1),e._v(" "),a("el-form-item",{attrs:{label:"请求方式",prop:"method"}},[a("el-select",{attrs:{placeholder:"请选择请求方式"},model:{value:e.createForm.method,callback:function(t){e.$set(e.createForm,"method",t)},expression:"createForm.method"}},e._l(e.apiTypes,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"返回类型",prop:"responseType"}},[a("el-input",{attrs:{placeholder:"例如：application/json"},model:{value:e.createForm.responseType,callback:function(t){e.$set(e.createForm,"responseType",t)},expression:"createForm.responseType"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"描述"}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入API描述"},model:{value:e.createForm.description,callback:function(t){e.$set(e.createForm,"description",t)},expression:"createForm.description"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.createDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleCreateConfirm}},[e._v(e._s(e.isEditMode?"更 新":"确 定"))])],1)],1)],1)},n=[],i=a("5530"),o=(a("7f7f"),a("f559"),a("7514"),a("7e39")),s=a("0112"),c={name:"ApiPublish",data:function(){return{list:[],listLoading:!1,total:0,query:{datasourceId:void 0,method:void 0,searchVal:void 0,pageNo:1,pageSize:20},datasourceList:[],apiTypes:[{value:"GET",label:"GET"},{value:"POST",label:"POST"},{value:"PUT",label:"PUT"},{value:"DELETE",label:"DELETE"}],createDialogVisible:!1,isEditMode:!1,currentEditId:null,createForm:{datasourceId:void 0,name:"",path:"",method:"",responseType:"application/json",description:"",status:1},createRules:{datasourceId:[{required:!0,message:"请选择数据源",trigger:"change"}],name:[{required:!0,message:"请输入名称",trigger:"blur"}],path:[{required:!0,message:"请输入Path",trigger:"blur"}],method:[{required:!0,message:"请选择请求方式",trigger:"change"}],responseType:[{required:!0,message:"请输入返回类型",trigger:"blur"}]}}},computed:{dialogTitle:function(){return this.isEditMode?"查看API":"创建API"}},created:function(){this.getDataSourceList(),this.fetchData()},methods:{getDataSourceList:function(){var e=this;o["d"]().then((function(t){e.datasourceList=t||[]})).catch((function(){e.datasourceList=[]}))},fetchData:function(){var e=this;this.listLoading=!0;var t={pageNo:this.query.pageNo,pageSize:this.query.pageSize,searchVal:this.query.searchVal,datasourceId:this.query.datasourceId,method:this.query.method};s["d"](t).then((function(t){var a=t&&t.data?t.data:t,r=a.records||[];e.list=e.attachDatasourceName(r),e.total=a.total||0})).catch((function(){e.list=[]})).finally((function(){e.listLoading=!1}))},formatMethod:function(e){var t=this.apiTypes.find((function(t){return t.value===e}));return t?t.label:e||"-"},formatStatus:function(e){return 0===e||"0"===e?"禁用":1===e||"1"===e?"待发布":2===e||"2"===e?"已发布":"未知"},statusTagType:function(e){return 0===e||"0"===e?"info":1===e||"1"===e?"warning":2===e||"2"===e?"success":"info"},handleCreate:function(){var e=this;this.isEditMode=!1,this.currentEditId=null,this.createDialogVisible=!0,this.$nextTick((function(){e.$refs.createFormRef&&e.$refs.createFormRef.resetFields(),e.createForm={datasourceId:void 0,name:"",path:"",method:"",responseType:"application/json",description:"",status:1}}))},handleCreateConfirm:function(){var e=this;this.$refs.createFormRef.validate((function(t){if(t){var a=e.createForm.path;a&&!a.startsWith("/api/ds/v1")?(a.startsWith("/")||(a="/"+a),a="/api/ds/v1"+a):a||(a="/api/ds/v1");var r={datasourceId:e.createForm.datasourceId,name:e.createForm.name,path:a,method:e.createForm.method,responseType:e.createForm.responseType,description:e.createForm.description,status:e.createForm.status||1};e.isEditMode&&e.currentEditId?(r.id=e.currentEditId,s["e"](r).then((function(){e.$message.success("更新API成功"),e.createDialogVisible=!1,e.fetchData()})).catch((function(){e.$message.error("更新API失败")}))):s["a"](r).then((function(){e.$message.success("创建API成功"),e.createDialogVisible=!1,e.fetchData()})).catch((function(){e.$message.error("创建API失败")}))}}))},handleView:function(e){var t=this;s["c"](e.id).then((function(a){if(a){t.isEditMode=!0,t.currentEditId=e.id;var r=a.path||"";r.startsWith("/api/ds/v1")&&(r=r.substring("/api/ds/v1".length)),t.createForm={datasourceId:a.datasourceId,name:a.name||"",path:r,method:a.method||"",responseType:a.responseType||"application/json",description:a.description||"",status:a.status||1},t.createDialogVisible=!0,t.$nextTick((function(){t.$refs.createFormRef&&t.$refs.createFormRef.clearValidate()}))}})).catch((function(){t.$message.error("加载API详情失败")}))},handleEdit:function(e){this.$router.push({path:"/datax/integration/apiPublish/edit",query:{id:e.id,datasourceId:e.datasourceId,dataSource:e.dataSource}})},handleEnable:function(e){var t=this;this.$confirm("确认启用 API「".concat(e.name,"」吗？"),"提示",{type:"warning"}).then((function(){s["f"]({id:e.id,status:1}).then((function(){t.$message.success("启用API成功"),t.fetchData()})).catch((function(){t.$message.error("启用API失败")}))})).catch((function(){}))},handleDisable:function(e){var t=this;this.$confirm("确认禁用 API「".concat(e.name,"」吗？"),"提示",{type:"warning"}).then((function(){s["f"]({id:e.id,status:0}).then((function(){t.$message.success("禁用API成功"),t.fetchData()})).catch((function(){t.$message.error("禁用API失败")}))})).catch((function(){}))},handleDelete:function(e){var t=this;this.$confirm("确认删除 API「".concat(e.name,"」吗？"),"提示",{type:"warning"}).then((function(){s["b"]([e.id]).then((function(){t.$message.success("删除API成功"),t.fetchData()})).catch((function(){t.$message.error("删除API失败")}))})).catch((function(){}))},handleSizeChange:function(e){this.query.pageSize=e,this.query.pageNo=1,this.fetchData()},handleCurrentChange:function(e){this.query.pageNo=e,this.fetchData()},attachDatasourceName:function(e){if(!e||!e.length)return[];var t=this.datasourceList.reduce((function(e,t){return e[t.id]=t.datasourceName||t.datasource,e}),{});return e.map((function(e){return Object(i["a"])(Object(i["a"])({},e),{},{datasourceName:e.datasourceName||t[e.datasourceId]||""})}))}}},l=c,u=(a("2de2"),a("2877")),d=Object(u["a"])(l,r,n,!1,null,"3018f302",null);t["default"]=d.exports},"2de2":function(e,t,a){"use strict";a("19fb")},7514:function(e,t,a){"use strict";var r=a("5ca1"),n=a("0a49")(5),i="find",o=!0;i in[]&&Array(1)[i]((function(){o=!1})),r(r.P+r.F*o,"Array",{find:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}}),a("9c6c")(i)},"7e39":function(e,t,a){"use strict";a.d(t,"e",(function(){return n})),a.d(t,"c",(function(){return i})),a.d(t,"g",(function(){return o})),a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return c})),a.d(t,"f",(function(){return l})),a.d(t,"d",(function(){return u}));var r=a("b775");function n(e){return Object(r["a"])({url:"/api/jobJdbcDatasource",method:"get",params:e})}function i(e){return Object(r["a"])({url:"/api/jobJdbcDatasource/"+e,method:"get"})}function o(e){return Object(r["a"])({url:"/api/jobJdbcDatasource",method:"put",data:e})}function s(e){return Object(r["a"])({url:"/api/jobJdbcDatasource",method:"post",data:e})}function c(e){return Object(r["a"])({url:"/api/jobJdbcDatasource",method:"delete",params:e})}function l(e){return Object(r["a"])({url:"/api/jobJdbcDatasource/test",method:"post",data:e})}function u(e){return Object(r["a"])({url:"/api/jobJdbcDatasource/all",method:"get",params:e})}}}]);